<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Quantization - AI Pocket Reference: NLP</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A streamlined reference manual for AI practitioners, students, and developers to quickly look up core concepts and mock implementations">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../_common/mdbook-ai-pocket-reference.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AI Pocket Reference: NLP</h1>

                    <div class="right-buttons">
                        <a href="https://vectorinstitute.github.io/ai-pocket-reference/" title="Home" aria-label="Home">
                            <i id="home-button" class="fa fa-home"></i>
                        </a>
                        <a href="https://github.com/VectorInstitute/ai-pocket-reference" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quantization"><a class="header" href="#quantization">Quantization</a></h1>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2em;">
  <div>
    <a target="_blank" href="https://github.com/VectorInstitute/ai-pocket-reference/issues/new?template=edit-request.yml">
      <img src="https://img.shields.io/badge/Suggest_an_Edit-black?logo=github&style=flat" alt="Suggest an Edit"/>
    </a>
    <p style="margin: 0;"><small>Reading time: 4 min</small></p>
  </div>
</div>
<h2 id="1-introduction-to-quantization"><a class="header" href="#1-introduction-to-quantization">1. Introduction to Quantization</a></h2>
<p>Quantization reduces the numerical precision of the weights and activations of
a neural network from a high-precision datatype to a lower-precision datatype.
The standard datatype for neural network weights and activations is fp32 (float32),
but quantization methods enable use of lower-precision representations, most commonly
8-bit integers (int8) and 16-bit floats (float16 or bfloat16). Even 4-bit integers
see use. Think of it like compressing a high-definition image into a
lower-resolution format â€“ you lose some detail, but gain efficiency.</p>
<p><strong>Why Quantization?</strong></p>
<ul>
<li><strong>Lower Memory Requirements:</strong> Reduced bit-depth directly translates to smaller
model memory footprint, saving memory capacity and bandwidth during model storage
and inference. This also makes it feasible to deploy larger, more performant models
on resource-constrained devices.</li>
<li><strong>Faster Throughput:</strong> Lower precision is significantly faster and more energy-efficient
on modern hardware. Modern GPUs with tensor cores (like NVIDIA's Ampere and Hopper
architectures) can perform low and mixed-precision matrix multiplications with
significantly higher throughput than FP32.</li>
</ul>
<h2 id="2-how-quantization-works"><a class="header" href="#2-how-quantization-works">2. How Quantization Works</a></h2>
<p>This mapping is typically done using <em>affine quantization</em> or <em>symmetric quantization</em>.
For example, an affine quantization from fp32 to int8 involves two parameters for
each tensor being quantized:</p>
<ul>
<li><strong>Scale (S):</strong> A positive floating-point number that determines the step size
between quantized integer values. It essentially scales the integer range back
to the floating-point range.</li>
<li><strong>Zero-point (Z):</strong> An integer that represents the floating-point value 0 in
the quantized integer space. This is important for accurately representing zero
values, which are common in neural networks (e.g., after ReLU activations).</li>
</ul>
<p>The relationship between a floating-point value (\(x\)) and its quantized
integer representation (\(x_q\)) is defined by:</p>
<p>$$x = S (x_q - Z).$$</p>
<p>To quantize a float value \(x\) to its integer representation \(x_q\), we solve:</p>
<p>$$x_q = \text{round}\left(\frac{x}{S} + Z\right).$$</p>
<p>Values outside the representable range of the target type
(e.g., [-128, 127] for int8) are typically clipped to the nearest representable
value. Symmetric quantization is a simplified version where the zero-point (Z)
is forced to be 0. This is achieved by choosing a symmetric range around zero
for quantization (e.g., [-max_abs_value, +max_abs_value]).</p>
<h2 id="3-types-of-quantization--calibration"><a class="header" href="#3-types-of-quantization--calibration">3. Types of Quantization &amp; Calibration</a></h2>
<p>To quantize a model, we need not only quantize the tensors holding the weights,
but also the tensors holding the activations â€” otherwise the computation mix
data types. There are different quantization approaches, each with its
trade-offs in terms of performance, and implementation complexity.
In all cases, we need to determine the range of values for the weights
and activations. This is known as <em>calibration</em>. Calibrating weights is
straightforward, because they are static, but calibrating activations is more
challenging because they are data dependent:</p>
<ul>
<li>
<p><strong>Dynamic Quantization</strong></p>
<ul>
<li><strong>How it works:</strong> Weights are quantized when loading the model. Activations
are quantized <em>dynamically</em> just before compute operations and de-quantized back
to high-precision afterwards.</li>
<li><strong>Pros:</strong> Easiest to implement and reduces model weight memory footprint.</li>
<li><strong>Cons:</strong> Activations are still stored and passed between layers in
high-precision format, limiting memory bandwidth and throughput benefits.</li>
</ul>
</li>
<li>
<p><strong>Static Quantization</strong></p>
<ul>
<li><strong>How it works:</strong> Both weights and activations are quantized. <em>Static</em>
quantization requires a calibration step to determine the ranges for activation
tensors. This is done by running a representative dataset through the
high-precision model to collect activation statistics and compute the activation
ranges. These statistics are then used to calculate the (S, Z) parameters
<em>before</em> run-time.</li>
<li><strong>Pros:</strong> Better throughput than dynamic quantization as both weights and
activations are quantized.</li>
<li><strong>Cons:</strong> Requires collection of a calibration dataset and offline
calibration step.</li>
</ul>
</li>
</ul>
<h2 id="4-limitations-and-considerations"><a class="header" href="#4-limitations-and-considerations">4. Limitations and Considerations</a></h2>
<ul>
<li><strong>Performance Degradation:</strong> Quantization, especially to very low-precision
datatypes, can lead to some loss of performance. Careful evaluation is needed
for peformance-sensitive applications.</li>
<li><strong>Hardware and Operator Support:</strong> Quantization support is not universal.
It depends on the target hardware and the deep learning framework. Not all operators
might have efficient quantized implementations on all platforms. Make sure to verify
your framework and hardware documentation for compatibility.</li>
</ul>
<h4 id="references--useful-links"><a class="header" href="#references--useful-links">References &amp; Useful Links <!-- markdownlint-disable-line MD001 --></a></h4>
<ol>
<li><a href="https://arxiv.org/abs/1712.05877">Jacob, Benoit, et al. "Quantization and training of
neural networks for efficient integer-arithmetic-only inference", CVPR 2018</a></li>
<li><a href="https://pytorch.org/docs/stable/quantization.html">PyTorch Quantization Documentation</a></li>
</ol>
<!-- markdownlint-disable-file MD033 -->
<hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
<div class="contributor-footnotes">
<small>
<strong>Contributors:</strong>
<div style="display: flex; gap: 8px; margin-top: 10px;">
<a href="https://github.com/jwilles">
<img src="https://github.com/jwilles.png"
  width="32px" alt="Contributor jwilles" style="border-radius: 50%">
</a>
</div>
</small>
</div>
<div class="vector-logo">
    <a href="https://vectorinstitute.ai/">
        <img src="https://d3ddy8balm3goa.cloudfront.net/vector-ai-pocket-refs/vector-logo-default.png" alt="" class="light-logo">
    </a>
    <a href="https://vectorinstitute.ai/">
        <img src="https://d3ddy8balm3goa.cloudfront.net/vector-ai-pocket-refs/vector-logo-dark.png" alt="" class="dark-logo">
    </a>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../llms/rag/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../llms/efficient_inference/kv_cache.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../llms/rag/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../llms/efficient_inference/kv_cache.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
